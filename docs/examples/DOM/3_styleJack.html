<!DOCTYPE html>
<html>
<head>
    <title>KUBEjs StyleJack: StyleSheet Abstraction and Basic API</title>
    <!-- Include KUBE.js -->
    <script src="../../../src/KUBE.js"></script>

    <!-- StyleJack: Basic Usage -->
    <script type="text/javascript">

        //Let's use DomJack && StyleJack
        var uses = {
            'DJ':'/Library/DOM/DomJack',
            'SJ':'/Library/DOM/StyleJack',
            'TextKing':'/Library/DOM/TextKing'
        };

        //Let our dependencies load
        KUBE.Uses(uses,function($K){
            //DJ() when called empty actually returns WinDocJack which has access to our DOMContentLoaded event management (Ready)
            $K.DJ().Ready(styleJackExample);
        });

        function styleJackExample(){
            //Because of the wrangling to get to a space where you can render to the DOM, it's sometimes easier to get KUBE Classes directly
            var DJ = KUBE.Class('/Library/DOM/DomJack');
            var SJ = KUBE.Class('/Library/DOM/StyleJack');
            var TextKing = KUBE.Class('/Library/DOM/TextKing')(['Arial',14]);

            /*
             * StyleJack is not fundamentally an inline style layer but instead it is an entire StyleSheet abstraction. This makes it well suited for managing CSS classes, as opposed to just inline styles
             * It provides:
             *  -Special CSS Rule Handling
             *  -Explicit CSS APIs
             *  -Convenience methodology for specific APIs
             *
             *  In this section we will look at StyleJack: Class Management / general Style APIs
             *
             *  StyleJack takes in a mixed argument, and has different behavior based on the constructor argument
             *      1. string argument. In this case StyleJack parses the string, and attempts to search the global stylesheets, and identify a matching CSSRule for the string.
             *          a. In the event that the string is a special rule (ie. @font-face) it will attempt to provide a context specific API
             *          b. In the event that the string can resolve into a basic rule, it provides the basic style API back
             *
             *      2. DOMNode. In this case StyleJack looks down the node for its own StyleRules, at which point it binds its basic style API to the individual Nodes StyleRules, resulting in an inline style interface
             */

            /*
             * StyleJack Class API Level 1 Methods:
             *  -Delete
             *  -GetStyleObj
             *  -Appearance
             *  -BackfaceVisibility
             *  -Background
             *  -Border
             *  -Bottom
             *  -Box
             *  -CaptionSide
             *  -Clip
             *  -Color
             *  -Content
             *  -Cursor
             *  -Direction
             *  -Display
             *  -EmptyCells
             *  -Float
             *  -Font
             *  -Height
             *  -Left
             *  -LetterSpacing
             *  -LineHeight
             *  -Margin
             *  -MinHeight
             *  -MinWidth
             *  -MaxHeight
             *  -MaxWidth
             *  -Opacity
             *  -Outline
             *  -Overflow
             *  -Padding
             *  -Position
             *  -Resize
             *  -Right
             *  -TableLayout
             *  -Text
             *  -Top
             *  -Transform
             *  -Transition
             *  -VerticalAlign
             *  -Visibility
             *  -Width
             *  -WhiteSpace
             *  -WordSpacing
             *  -WordBreak
             *  -WordWrap
             *  -ZIndex
             */

            /*
             * The APIs provided by Level 1 StyleJack follow a specific pattern:
             *  -'$'            ie: StyleJack('.class').Top('$') will return the raw value from the actual CSSStyleRule object
             *  -mixedVar       ie: StyleJack('.class').Top(10) will attempt to parse the value appropriately as best as possible, set the right rule, and return the Level 1 API for chaining
             *  -No argument    ie: StyleJack('.class').Top() will return the value the API thinks most useful (parsed if possibly) OR an explicit Level 2 API if applicable
             */

            //In this example we will be looking specifically in the context of classes, so we pass a class string into the constructor, which in turn will return a level 1 API for working on that class
            var BoxClass = SJ('.box');

            //Quickly because global margin/padding is stupid, let's turn it off also let's set Box Sizing to Border Box
            DJ(document.body).Style().Margin(0).Padding(0).Font().Family('Arial').Size(14).api.Box().Sizing('border-box');

            //Let's do a really basic set chain (we are using INTs here which will be auto translated to px strings)
            BoxClass.Margin(10).Width(100).Height(100).Position('relative').Border('1px solid black');

            /*

             //The CSS equivalent is

            .box{
                top:10px;
                left:10px;
                width:100px;
                height:100px;
                position:relative;
            }

             */

            //Grab our body
            var Body = DJ(document.body);

            //Let's make a box (create a new div, add the box class to the div)
            var Box = DJ('div').AddClass('.box');

            //We'll append it to our Body
            Body.Append(Box);

            //Now let's whip up a property table in CSS (we are going to use TextKing to cheat and make flexible but consistent column widths)
            SJ('.table').Position('relative').Margin(10).Border().Top('1px solid black').Left('1px solid black');
            SJ('.row').Position('relative').Height(30).Border().Bottom('1px solid black');
            SJ('.col').Position('relative').Height(30).LineHeight(30).Float('left').Border().Right('1px solid black').api.Text().Align('center');

            //We will use textKing for setting up our measurements
            var measurements = {'label':0,'rawVal':0,'parseVal':0,'subAPI':0}
            function measure(_key,_string){
                var currentVal = measurements[_key];
                var checkVal = Math.floor(TextKing.MeasureString(_string).width)+50;
                if(checkVal > currentVal){
                    SJ('.'+_key).Width(checkVal);
                    measurements[_key] = checkVal;
                }

                console.log(measurements);
                var total = measurements.label+measurements.rawVal+measurements.parseVal+measurements.subAPI;
                //alert(total);
                if(SJ('.table').Width() < total){
                    SJ('.table').Width(Math.floor(total)+5);
                }
            }

            //Our faux table
            var PropTable = DJ('div').AddClass('.table');
            rowBuilder('','Raw Value','Parsed Value','Level 2 API');
            rowBuilder('Top',BoxClass.Top('$'),BoxClass.Top(),'false');
            rowBuilder('Left',BoxClass.Left('$'),BoxClass.Left(),'false');
            rowBuilder('Border',BoxClass.Border('$'),JSON.stringify(BoxClass.Border().Get()),'true');
            rowBuilder('Margin',BoxClass.Margin('$'),JSON.stringify(BoxClass.Margin().Get()),'true');

            //Build our row out
            function rowBuilder(_label,_rawVal,_parseVal,_subAPI){
                //Initialize a row
                var Row = PropTable.Append('div').AddClass('.row');

                //Our label column
                Row.Append('div').AddClass(['.col','.label']).SetInner(_label);
                measure('label',_label);

                //Our raw value column
                Row.Append('div').AddClass(['.col','.rawVal']).SetInner(_rawVal);
                measure('rawVal',_rawVal);

                //Parsed value
                Row.Append('div').AddClass(['.col','.parseVal']).SetInner(_parseVal);
                measure('parseVal',_parseVal);

                //Sub API
                Row.Append('div').AddClass(['.col','.subAPI']).SetInner(_subAPI);
                measure('subAPI',_subAPI);
            }

            Body.Append(PropTable);
        }

    </script>
</head>
<body>

</body>
</html>