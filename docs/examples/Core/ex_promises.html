<!DOCTYPE html>
<html>
<head lang="en">
    <title></title>
    <script src="../../../src/KUBE.js"></script>

    <script type="text/javascript">

        function ECMAAjax(url,request,method,headers,username,password){
            var req = new XMLHttpRequest();
            headers = (KUBE.Is(headers) === "object" ?  headers : {});
            return new Promise(function(resolve,reject){
                req.open(method || "GET", url, true,username,password);

                Object.keys(headers).forEach(function(k){
                    req.setRequestHeader(k, headers[k]);
                });

                req.onreadystatechange = function(e){
                    if(req.readyState !== 4){
                        return;
                    }

                    if([200,304].indexOf(req.status) < 0){
                        reject(new Error('Server responded with status of ' + req.status));
                    }
                    else{
                        resolve(e.target.response);
                    }
                }

                req.send(request || undefined);
            });

        }

        function KUBEAjax(url,request,method,headers,username,password) {
            var req = new XMLHttpRequest();
            headers = (KUBE.Is(headers) === "object" ? headers : {});
            return KUBE.Promise(function (resolve,reject) {
                req.open(method || "GET", url, true, username, password);

                Object.keys(headers).forEach(function(k){
                    req.setRequestHeader(k, headers[k]);
                });


                req.onreadystatechange = function (e) {
                    if (req.readyState !== 4) {
                        return;
                    }

                    if ([200, 304].indexOf(req.status) < 0) {
                        reject(new Error('Server responded with status of ' + req.status));
                    }
                    else {
                        resolve(e.target.response);
                    }
                }

                req.send(request || undefined);
            });
        }
        ECMAAjax('<URL>').then(function(data){
            var j = document.createElement('div');
            j.innerHTML = data;
            j.style.border = '15px solid red';
            document.body.appendChild(j);
        },function(){console.log(arguments)});


        KUBEAjax('<URL>').then(function(resolve,reject,data){
            var j = document.createElement('div');
            j.innerHTML = data;
            j.style.border = '15px solid #3dff4d';
            document.body.appendChild(j);
        },function(resolve,reject,error){
            var j = document.createElement('div');
            j.innerHTML = "Request failed :(";
            j.style.border = '15px solid #3dff4d';
            document.body.appendChild(j);
            resolve();
        }).then(function(resolve,reject){
            console.log('xxx');
        });

    </script>
</head>
<body>

</body>
</html>